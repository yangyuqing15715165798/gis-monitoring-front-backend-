### 数据流向详细解释

当前GIS局放在线监测系统Demo的数据流向可以分为以下几个主要阶段：

1.  **数据源头：`backend/data.json` 文件**
    *   **位置：** 所有的GIS设备数据（包括设备基本信息、模拟的局放趋势、PRPD/PRPS/频谱类型、告警记录等）都以JSON格式存储在项目根目录下的 `backend/data.json` 文件中。
    *   **性质：** 这个文件充当了Demo的“数据库”，它是一个静态文件，包含了初始的设备数据。

2.  **后端数据处理与API暴露：FastAPI 服务 (`backend/main.py`)**
    *   **启动：** 当您运行 `uvicorn main:app --reload --host 127.0.0.1 --port 5000` 命令时，FastAPI后端服务被启动，监听在 `http://127.0.0.1:5000` 端口。
    *   **数据读取：**
        *   FastAPI应用中的 `load_device_data()` 函数负责读取 `backend/data.json` 文件的内容，并将其解析为Python对象（列表和字典）。
    *   **模拟实时更新：**
        *   这是关键的一步。在FastAPI的API路由（`@app.get("/api/devices")` 和 `@app.get("/api/devices/{device_id}")`）中，每次接收到前端请求时，都会调用 `update_simulated_data()` 函数。
        *   `update_simulated_data()` 函数会对从 `data.json` 读取到的数据进行**动态修改**。这些修改包括：
            *   `latestPd`（最新局放值）的小幅随机波动。
            *   `temperature`、`humidity`、`sf6Pressure`（辅助参数）的小幅随机波动。
            *   `pdTrend`（局放趋势数据）的滚动更新，模拟新数据点的流入和旧数据点的移除。
            *   根据模拟的 `latestPd` 值，有概率地改变设备的 `status`（从“正常”到“异常”或反之），并相应地更新 `alerts`（告警）和 `diagnosis`（诊断结果），以及 `prpdType`、`spectrumType`、`prpsType`（局放图谱类型）。
        *   这意味着，每次前端请求数据时，后端返回的都是一个**经过模拟实时变化**的设备数据快照。
    *   **API响应：** FastAPI将处理后的Python数据结构转换为JSON格式，并通过HTTP响应发送给前端。

3.  **前端数据请求与接收：JavaScript `fetch` API (`script.js`)**
    *   **启动：** 当您在浏览器中打开前端页面 (`index.html`) 时，`script.js` 开始执行。
    *   **定时请求：** `script.js` 中的 `startRealtimeUpdates()` 函数会启动一个 `setInterval` 定时器，每隔3秒调用 `updateRealtimeData()` 函数。
    *   **数据请求：**
        *   `updateRealtimeData()` 函数使用 JavaScript 的 `fetch` API 向后端FastAPI服务的 `/api/devices` 接口发送HTTP GET请求（`fetch('http://127.0.0.1:5000/api/devices')`）。
        *   当用户点击设备列表中的“查看详情”按钮时，`showDeviceDetail()` 函数会向后端FastAPI服务的 `/api/devices/{device_id}` 接口发送HTTP GET请求，获取特定设备的详细数据。
    *   **数据接收与解析：** 前端接收到HTTP响应后，使用 `response.json()` 方法将JSON格式的响应体解析为JavaScript对象。

4.  **前端数据展示与更新：JavaScript DOM操作与图表库 (`script.js`)**
    *   **全局数据更新：** `updateRealtimeData()` 函数接收到最新的设备数据后，会更新全局的 `devices` 数组。
    *   **Dashboard更新：** `updateDashboard()` 函数根据 `devices` 数组中的数据，更新Dashboard区域的设备总数、在线设备数、异常设备数和最新告警列表。
    *   **设备列表更新：** `populateDeviceList()` 函数根据 `devices` 数组，重新渲染设备列表，显示最新的设备状态和局放值。
    *   **趋势图更新：**
        *   对于Dashboard上的“实时局放趋势图”和设备详情页的“局放幅值趋势图”，`script.js` 会直接更新Chart.js图表实例的数据 (`chart.data.datasets[0].data`) 和标签 (`chart.data.labels`)。
        *   然后调用 `chart.update()`，Chart.js会利用其动画功能，使曲线平滑地滚动和变化，模拟实时数据流。
    *   **详情页图谱更新：**
        *   当进入设备详情页或详情页数据更新时，`showDeviceDetail()` 函数会根据从后端获取的设备数据，重新生成并渲染PRPD图谱（使用Chart.js）、PRPS三维图（使用Plotly.js）和频谱图（使用Chart.js）。由于这些图谱的模式可能随设备状态变化，所以每次都重新创建图表实例。
    *   **文本信息更新：** 设备详情页的其他文本信息（如温度、湿度、SF6压力、诊断结果等）也会根据后端返回的最新数据进行更新。

**总结数据流向路径：**

`backend/data.json` (静态数据)
  ↓
FastAPI后端 (`backend/main.py`) 读取并**模拟实时更新**
  ↓
FastAPI通过HTTP响应（JSON格式）暴露API (`/api/devices`, `/api/devices/{device_id}`)
  ↓
前端JavaScript (`script.js`) 使用 `fetch` API 定时请求数据
  ↓
前端JavaScript解析JSON数据
  ↓
前端页面（`index.html`）通过DOM操作和Chart.js/Plotly.js图表库进行**实时动态展示**

这个流程实现了数据的动态获取和展示，使得Demo能够模拟真实系统中数据的流动和变化。
